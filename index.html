<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Puppet-pssh by rubiojr</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Puppet-pssh</h1>
        <h2>Run commands on multiple puppet nodes using parallel-ssh</h2>

        <section id="downloads">
          <a href="https://github.com/rubiojr/puppet-pssh/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/rubiojr/puppet-pssh/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/rubiojr/puppet-pssh" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>puppet-pssh</h1>

<p>Puppet parallel-ssh integration.</p>

<p>Needs parallel-ssh installed (apt-get install pssh on Ubuntu/Debian).</p>

<h1>Install</h1>

<pre><code>gem install puppet-pssh
</code></pre>

<h1>Usage</h1>

<p>The command has a built-in help:</p>

<pre><code>puppet-pssh --help
</code></pre>

<p>The run command:</p>

<pre><code>puppet-pssh run --puppetmaster 192.168.1.1 \ 
                --match 'openstack-compute' \
                --nameserver 10.0.0.1 \
                --no-host-key-verify \
                --threads 20 \                # use up to 20 threads
                puppet agent -t
</code></pre>

<p>This will run the command 'puppet agent -t' on every node whose FQDN matches /openstack-compute/ (regexp). It will try to resolve node names using DNS server 10.0.0.1 and use the IP address instead.
Also, SSH host key verification has been disabled.</p>

<h1>Tips</h1>

<p>Clean node's /var/lib/puppet and revoke node cert on master also:</p>

<pre><code># Clean /var/lib/puppet in node
puppet-pssh run 'find /var/lib/puppet -type f|xargs rm'
# Revoke cert (this will run in the node!)
puppet-pssh run 'curl -k -X PUT -H "Content-Type: text/pson" --data '\''{"desired_state":"revoked"}'\'' https://puppetmaster.devel.bvox.net:8140/development/certificate_status/`hostname -f`'
puppet-pssh run 'curl -k -X DELETE -H "Accept: pson" https://puppetmaster.devel.bvox.net:8140/development/certificate_status/`hostname -f`'
</code></pre>

<p>Your puppet master's auth.conf will need some rules for this to work. See:</p>

<p><a href="http://www.mail-archive.com/puppet-users@googlegroups.com/msg35412.html">http://www.mail-archive.com/puppet-users@googlegroups.com/msg35412.html</a></p>

<h1>Copyright</h1>

<p>Copyright (c) 2012 Sergio Rubio. See LICENSE.txt for
further details.</p>
      </section>
    </div>

    
  </body>
</html>